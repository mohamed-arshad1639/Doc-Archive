<div class="list-view p-4 pb-24 bg-primary-bg min-h-screen">
  
  <div class="flex items-center justify-between mb-6">
    <div class="flex items-center gap-4">
      @if (currentFolderId) {
         <button (click)="navigateUp()" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors text-gray-600 dark:text-gray-300">
           <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5"/><path d="M12 19l-7-7 7-7"/></svg>
         </button>
         <h1 class="text-lg font-bold text-jet-black dark:text-off-white flex items-center">
           <span (click)="navigateUp()" class="text-gray-400 font-normal hover:text-gray-600 dark:hover:text-gray-200 cursor-pointer transition-colors mr-2">Home &gt;</span> 
           {{ currentFolder?.name || 'Loading...' }}
         </h1>
      } @else {
         <h1 class="text-lg font-bold text-jet-black dark:text-off-white">All Documents</h1>
      }
    </div>

    <button (click)="showNewFolderDialog = true" class="flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors shadow-sm">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path><line x1="12" y1="11" x2="12" y2="17"></line><line x1="9" y1="14" x2="15" y2="14"></line></svg>
      <span>New Folder</span>
    </button>
  </div>

  <!-- Loading Skeleton -->
  @if (loading) {
    <div class="flex flex-col space-y-2">
      @for (i of [1,2,3,4,5,6]; track i) {
        <div class="flex items-center p-3 bg-white dark:bg-dark-gray rounded-lg shadow-sm animate-pulse border border-transparent">
          <div class="w-12 h-12 flex-shrink-0 bg-gray-200 dark:bg-gray-700 rounded mr-4"></div>
          <div class="flex-grow min-w-0">
             <div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/3 mb-2"></div>
             <div class="h-3 bg-gray-200 dark:bg-gray-700 rounded w-1/4"></div>
          </div>
        </div>
      }
    </div>
  } @else {
    <div class="flex flex-col space-y-2">
      <!-- Folders List -->
      @for (folder of folders; track folder.id) {
         <div class="flex items-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg shadow-sm hover:bg-blue-100 dark:hover:bg-blue-900/40 transition-colors cursor-pointer border border-transparent hover:border-blue-200" 
              (click)="onFolderSelect(folder)"
              (dragover)="onDragOver($event)" 
              (drop)="onDrop($event, folder)">
          <div class="w-12 h-12 flex-shrink-0 flex items-center justify-center text-blue-500 mr-4">
             <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round">
               <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
             </svg>
          </div>
          <div class="flex-grow min-w-0">
            <h3 class="font-medium text-jet-black dark:text-white truncate">{{ folder.name }}</h3>
            <p class="text-sm text-gray-500">Folder • {{ folder.createdAt | date:'shortDate' }}</p>
          </div>
          <div class="flex items-center gap-4 ml-4">
             <button class="p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition-colors text-gray-400 hover:text-red-500" (click)="$event.stopPropagation(); onFolderDelete(folder)" title="Delete Folder">
               <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
             </button>
             <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
          </div>
        </div>
      }
  
      <!-- Documents List -->
      @for (doc of documents; track doc) {
        <div class="flex items-center p-3 bg-white dark:bg-dark-gray rounded-lg shadow-sm hover:bg-gray-50 dark:hover:bg-opacity-80 transition-colors cursor-pointer" 
             (click)="onDocumentClick(doc)"
             draggable="true"
             (dragstart)="onDragStart($event, doc)">
          <div class="w-12 h-12 flex-shrink-0 bg-gray-200 rounded overflow-hidden mr-4">
            <img [src]="doc.thumbnail || 'assets/placeholder.png'" class="w-full h-full object-cover" alt="thumbnail">
          </div>
          <div class="flex-grow min-w-0">
            <h3 class="font-medium text-jet-black dark:text-white truncate">{{ doc.name }}</h3>
            <p class="text-sm text-gray-500">{{ doc.type }} • {{ doc.size | number }} bytes</p>
          </div>
          <div class="flex items-center gap-4 ml-4">
            <div class="text-xs text-gray-400 whitespace-nowrap">
              {{ doc.createdAt | date:'short' }}
            </div>
            <button class="p-2 hover:bg-gray-100 dark:hover:bg-dark-gray rounded-full transition-colors" (click)="toggleFavorite($event, doc)">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transition-colors" [attr.fill]="doc.isFavorite ? 'currentColor' : 'none'" viewBox="0 0 24 24" stroke="currentColor" [class.text-red-500]="doc.isFavorite" [class.text-gray-400]="!doc.isFavorite">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
              </svg>
            </button>
            <button class="p-2 hover:bg-gray-100 dark:hover:bg-dark-gray rounded-full transition-colors text-gray-400 hover:text-red-500" (click)="onDeleteDocument($event, doc)" title="Move to Trash">
               <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
            </button>
          </div>
        </div>
      }
    </div>
  
    @if (documents.length === 0 && folders.length === 0) {
      <app-empty-state
        [title]="currentFolderId ? 'Folder is empty' : 'No documents found'"
        [message]="currentFolderId ? 'This folder does not contain any documents yet.' : 'Your archive is empty. Create a folder or add documents to get started.'"
        [icon]="currentFolderId ? 'folder' : 'document'"
        [actionLabel]="currentFolderId ?  undefined : 'Create New Folder'"
        (action)="showNewFolderDialog = true">
      </app-empty-state>
    }
  }

  <!-- Modals -->
  @if (editingDoc) {
    <app-document-edit [doc]="editingDoc" (close)="editingDoc = null"></app-document-edit>
  }

  @if (showNewFolderDialog) {
    <app-new-folder-dialog (close)="showNewFolderDialog = false"></app-new-folder-dialog>
  }

  @if (showConfirmModal) {
    <app-confirmation-modal
      [title]="confirmModalConfig.title"
      [message]="confirmModalConfig.message"
      [type]="confirmModalConfig.type"
      (confirm)="confirmAction()"
      (cancel)="showConfirmModal = false">
    </app-confirmation-modal>
  }
</div>
